<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DOMPP CDN - Mini Apps Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #a8e6ff, #3ddad7);
      background-attachment: fixed;
      color: #1f2d3d;
    }

    .container {
      padding: 24px;
      max-width: 1200px;
      margin: auto;
    }

    h1 {
      text-align: center;
      color: white;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(6px);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 35px rgba(0, 0, 0, 0.12);
    }

    .card h3 {
      margin-top: 0;
      font-weight: 600;
      color: #0f4c5c;
    }

    button {
      padding: 8px 12px;
      margin: 6px 6px 0 0;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      color: white;
      background: linear-gradient(135deg, #4facfe, #00c9a7);
      transition: all 0.2s ease;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 201, 167, 0.4);
    }

    button:active {
      transform: translateY(0px);
      box-shadow: none;
    }

    input, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #dceef3;
      outline: none;
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus, textarea:focus {
      border-color: #3ddad7;
      box-shadow: 0 0 0 3px rgba(61, 218, 215, 0.2);
    }

    ul {
      padding-left: 18px;
    }

    .clock {
      font-size: 26px;
      font-weight: 600;
      text-align: center;
      color: #0f4c5c;
    }

    .footer {
      text-align: center;
      margin-top: 40px;
      color: white;
      opacity: 0.85;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import "../../../src/index.js";
    import { installDomppReconcile } from "../../../src/addons/reconcile.addon.js";
    import { installDomppStateful } from "../../../src/reactive/stateful.js";

    installDomppReconcile({ overrideSetters: true });
    installDomppStateful();

    function createCard(titleText) {
      const card = document.createElement("div");
      card.className = "card";

      const title = document.createElement("h3");
      title.textContent = titleText;

      card.appendChild(title);
      return { card };
    }

    function App() {

      console.log("App executed once");

      /* ================= OUTER WRAPPER (theme background) ================= */
      const wrapper = document.createElement("div")
        .setState({ darkMode: false })
        .setStyles(({ state }) => ({
          minHeight: "100vh",
          transition: "all 0.3s ease",
          background: state.darkMode
            ? "linear-gradient(135deg, #1e1e2f, #111)"
            : "linear-gradient(135deg, #a8e6ff, #3ddad7)"
        }));

      /* ================= CONTAINER ================= */
      const container = document.createElement("div");
      container.className = "container";

      /* ================= TITLE ================= */
      const title = document.createElement("h1");
      title.textContent = "Mini Apps Dashboard";
      container.appendChild(title);

      /* ================= GLOBAL THEME CARD ================= */
      const { card: themeCard } = createCard("Global Theme Toggle (Top-Level State)");

      const desc = document.createElement("p");
      desc.textContent = "This state lives in App.";

      const btnTheme = document.createElement("button")
        .setText(({ state }) => state.darkMode
          ? "Switch to Light Mode"
          : "Switch to Dark Mode"
        )
        .setEvents({
          click: () => wrapper.setState(({ state }) => {
            state.darkMode = !state.darkMode;
          })
        });

      themeCard.append(desc, btnTheme);
      container.appendChild(themeCard);

      /* ================= GRID ================= */
      const grid = document.createElement("div");
      grid.className = "grid";
      container.appendChild(grid);

      /* ================= COUNTER ================= */
      const { card: counterCard } = createCard("Counter");
      const countValue = document.createElement("h2")
        .setState({ count: 0 })
        .setText(({ state }) => state.count);

      const btnMinus = document.createElement("button")
        .setText("-1")
        .setEvents({ click: () => countValue.setState(({ state }) => { state.count -= 1; }) });

      const btnPlus = document.createElement("button")
        .setText("+1")
        .setEvents({ click: () => countValue.setState(({ state }) => { state.count += 1; }) });

      const btnReset = document.createElement("button")
        .setText("Reset")
        .setEvents({ click: () => countValue.setState({ count: 0 }) });

      counterCard.append(countValue, btnMinus, btnPlus, btnReset);
      grid.appendChild(counterCard);

      /* ================= TODO ================= */
      const { card: todoCard } = createCard("Todo List");

      const createTodo = (text) => ({
        id: `todo-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,
        text
      });

      const todoListEl = document.createElement("ul")
        .setState({ todos: [] })
        .setChildren(({ state }) => {
          const templates = state.todos.map((todo) =>
            document.createElement("li")
              .setAttributes({ id: todo.id })
              .setText(todo.text)
          );

          return [...templates, { matchById: true }];
        });

      const inputTodo = document.createElement("input");
      inputTodo.placeholder = "Add task...";

      const btnAdd = document.createElement("button")
        .setText("Add")
        .setEvents({
          click: () => {
            const text = inputTodo.value.trim();
            if (!text) return;
            todoListEl.setState(({ state }) => {
              state.todos = [...state.todos, createTodo(text)];
            });
            inputTodo.value = "";
          }
        });

      todoCard.append(inputTodo, btnAdd, todoListEl);
      grid.appendChild(todoCard);

      /* ================= CLOCK ================= */
      const { card: clockCard } = createCard("Live Clock");
      const clockValue = document.createElement("div")
        .setAttributes({ class: "clock" })
        .setState({ time: new Date().toLocaleTimeString() })
        .setText(({ state }) => state.time);

      setInterval(() => {
        clockValue.setState({ time: new Date().toLocaleTimeString() });
      }, 1000);

      clockCard.appendChild(clockValue);
      grid.appendChild(clockCard);

      /* ================= NOTES ================= */
      const { card: notesCard } = createCard("Quick Notes");
      const textarea = document.createElement("textarea");
      textarea.rows = 4;
      textarea.placeholder = "Write something...";
      notesCard.appendChild(textarea);
      grid.appendChild(notesCard);

      /* ================= CALCULATOR ================= */
      const { card: calcCard } = createCard("Mini Calculator");
      const calcInput = document.createElement("input");
      calcInput.placeholder = "e.g. 2 + 2 * 3";

      const btnCalc = document.createElement("button")
        .setText("=")
        .setEvents({
          click: () => {
            try {
              const result = eval(calcInput.value).toString();
              calcInput.value = result;
            } catch {
              calcInput.value = "Error";
            }
          }
        });

      calcCard.append(calcInput, btnCalc);
      grid.appendChild(calcCard);

      /* ================= FOOTER ================= */
      const footer = document.createElement("div");
      footer.className = "footer";
      footer.textContent = "Built with DOMPP via CDN";
      container.appendChild(footer);

      wrapper.appendChild(container);
      return wrapper;
    }

    document.getElementById("app").setChildren(App());
  </script>
</body>
</html>

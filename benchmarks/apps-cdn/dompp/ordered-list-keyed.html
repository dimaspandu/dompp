<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DOMPP CDN - Ordered List Keyed</title>
</head>
<body>
  <div id="app"></div>
  <script type="module">
    import "../../../src/index.js";
    import { installDomppReconcile } from "../../../src/addons/reconcile.addon.js";
    import { installDomppStateful } from "../../../src/reactive/stateful.js";

    installDomppReconcile({ overrideSetters: true });
    installDomppStateful();

    const createItem = () => ({
      id: `item-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,
      message: "Hello, World!"
    });

    const app = document.getElementById("app");
    const timeline = document.createElement("section").setState({ items: [] });
    const list = document.createElement("ol");

    const refresh = ({ state }) => {
      const items = state.items.map((item) => ({
        ...item,
        message: item.message.replace(" (UPDATED!)", "")
      }));

      items.unshift(createItem());

      if (items.length > 5 && items[1]) {
        items[1].message += " (UPDATED!)";
      }

      state.items = items;
    };

    timeline.setChildren(({ state: { items } }) => {
      const templates = items.map((item) =>
        document.createElement("li")
          .setAttributes({ id: item.id })
          .setText(item.message)
      );

      list.setChildren(...templates, { matchById: true });
      return [list];
    });

    const btn = document.createElement("button")
      .setAttributes({ type: "button" })
      .setText("Refresh")
      .setEvents({ click: () => timeline.setState(refresh) });

    app.setChildren(timeline, btn);
  </script>
</body>
</html>

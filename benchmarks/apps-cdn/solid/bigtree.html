<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SolidJS CDN - Big Tree (Keyed Stable)</title>
  <style>
    body { font-family: system-ui; max-width: 960px; margin: 0 auto; padding: 24px; }
    section { margin-bottom: 24px; }
    .grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 16px; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 12px; }
    ul, ol { padding-left: 20px; }
    button { margin-right: 8px; }
    .static-grid { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 8px; }
    .static-cell { border: 1px dashed #ccc; padding: 6px; border-radius: 6px; font-size: 12px; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import { render } from "https://esm.sh/solid-js@1.8.19/web";
    import { createSignal, mapArray } from "https://esm.sh/solid-js@1.8.19";
    import h from "https://esm.sh/solid-js@1.8.19/h";

    const createTodo = (index) => ({
      id: `todo-${index}`,
      text: `Todo ${index}`
    });

    const createListItem = () => ({
      id: `item-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,
      message: "Hello, World!"
    });

    function App() {
      const [count, setCount] = createSignal(0);
      const [todos, setTodos] = createSignal(
        Array.from({ length: 100 }, (_, i) => createTodo(i))
      );
      const [items, setItems] = createSignal(
        Array.from({ length: 50 }, () => createListItem())
      );

      const mappedTodos = mapArray(
        () => todos(),
        (todo) => h("li", null, todo.text)
      );

      const mappedItems = mapArray(
        () => items(),
        (item) => h("li", null, () => item.message)
      );

      const staticCells = Array.from({ length: 200 }, (_, i) =>
        h("div", { class: "static-cell" }, `Static ${i + 1}`)
      );

      const refreshList = () => {
        const next = items().map((item) => ({
          ...item,
          message: item.message.replace(" (UPDATED!)", "")
        }));

        next.unshift(createListItem());

        if (next.length > 5 && next[1]) {
          next[1].message += " (UPDATED!)";
        }

        setItems(next);
      };

      return h("div", null,
        h("h1", null, "SolidJS Big Tree Workload (Keyed Stable)"),
        h("p", null, "Fine-grained reactivity with keyed list diff."),

        h("div", { class: "grid" },

          h("section", { class: "card" },
            h("h3", null, "Counter"),
            h("h2", null, () => `Count: ${count()}`),
            h("button", {
              type: "button",
              onClick: () => setCount(c => c + 1)
            }, "+1")
          ),

          h("section", { class: "card" },
            h("h3", null, "Todos (Keyed)"),
            h("ul", null, () => mappedTodos()),
            h("button", {
              type: "button",
              onClick: () =>
                setTodos(prev => [...prev, createTodo(prev.length)])
            }, "Add Todo")
          ),

          h("section", { class: "card" },
            h("h3", null, "Ordered List Keyed"),
            h("ol", null, () => mappedItems()),
            h("button", {
              type: "button",
              onClick: refreshList
            }, "Refresh List (prepend)")
          ),

          h("section", { class: "card" },
            h("h3", null, "Static Tree (200 nodes)"),
            h("div", { class: "static-grid" }, staticCells)
          )
        )
      );
    }

    render(App, document.getElementById("app"));
  </script>
</body>
</html>